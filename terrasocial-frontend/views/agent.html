<!-- Espace Agent TERRASOCIAL -->

<div class="agent-dashboard">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <h1>Espace Agent Immobilier</h1>
        <p class="subtitle">Gérez vos prospects et commissions</p>
    </div>

    <!-- Quick Stats -->
    <div class="grid-3">
        <div class="stat-box">
            <div class="stat-label">Prospects Actifs</div>
            <div class="stat-value" id="activeProspectsCount">0</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">Commissions Gagnées</div>
            <div class="stat-value" id="totalCommissions">0 XOF</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">Taux de Conversion</div>
            <div class="stat-value" id="conversionRate">0%</div>
        </div>
    </div>

    <!-- Tabs Navigation -->
    <div class="tabs-container">
        <button class="tab-button active" data-tab="prospects">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
            Mes Prospects
        </button>
        <button class="tab-button" data-tab="commissions">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/></svg>
            Commissions
        </button>
        <button class="tab-button" data-tab="performance">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2V17zm4 0h-2V7h2V17zm4 0h-2v-4h2V17z"/></svg>
            Performance
        </button>
    </div>

    <!-- Tab Contents -->

    <!-- Prospects Tab -->
    <div class="tab-content active" data-tab="prospects">
        <div class="tab-header">
            <h2>Mes Prospects</h2>
            <button class="btn btn-primary" onclick="openAddProspectModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Ajouter Prospect
            </button>
        </div>

        <div class="prospects-filters">
            <input type="text" id="prospectSearch" placeholder="Rechercher par nom ou email..." class="form-control">
            <select id="prospectStatus" class="form-control">
                <option value="">Tous les statuts</option>
                <option value="new">Nouveau</option>
                <option value="contacted">Contacté</option>
                <option value="qualified">Qualifié</option>
                <option value="converted">Converti</option>
            </select>
        </div>

        <div data-load="prospects" class="prospects-table">
            <div class="card">
                <div class="spinner"></div>
                <p style="text-align: center;">Chargement de vos prospects...</p>
            </div>
        </div>

        <div id="noProspects" style="display: none;">
            <div class="empty-state">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 11a4 4 0 0 0-7.5-2"></path>
                </svg>
                <h3>Aucun Prospect</h3>
                <p>Commencez à ajouter des prospects pour les suivre.</p>
                <button class="btn btn-primary" onclick="openAddProspectModal()">Ajouter un Prospect</button>
            </div>
        </div>
    </div>

    <!-- Commissions Tab -->
    <div class="tab-content" data-tab="commissions">
        <div class="tab-header">
            <h2>Mes Commissions</h2>
        </div>

        <div class="commissions-summary">
            <div class="commission-card">
                <h3>Commission Totale</h3>
                <div class="commission-value" id="totalCommissionValue">0 XOF</div>
            </div>
            <div class="commission-card">
                <h3>Commissions Payées</h3>
                <div class="commission-value" id="paidCommissionValue">0 XOF</div>
            </div>
            <div class="commission-card">
                <h3>Commissions En Attente</h3>
                <div class="commission-value pending" id="pendingCommissionValue">0 XOF</div>
            </div>
        </div>

        <div data-load="commissions" class="commissions-table">
            <table>
                <thead>
                    <tr>
                        <th>Prospect</th>
                        <th>Montant</th>
                        <th>Taux</th>
                        <th>Commission</th>
                        <th>Statut</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody id="commissionsBody">
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 2rem;">Chargement...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Performance Tab -->
    <div class="tab-content" data-tab="performance">
        <div class="tab-header">
            <h2>Mes Performances</h2>
        </div>

        <div class="performance-metrics grid-2">
            <div class="metric-card">
                <h3>Prospects par Statut</h3>
                <div class="metric-chart">
                    <div class="metric-bar">
                        <div class="bar-item" style="background: #2E7D32;">
                            <span>Nouveaux: 12</span>
                        </div>
                        <div class="bar-item" style="background: #FF9800;">
                            <span>Contactés: 8</span>
                        </div>
                        <div class="bar-item" style="background: #4CAF50;">
                            <span>Qualifiés: 5</span>
                        </div>
                        <div class="bar-item" style="background: #81C784;">
                            <span>Convertis: 3</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="metric-card">
                <h3>Commissions par Mois</h3>
                <div class="metric-chart">
                    <canvas id="commissionsChart" style="width: 100%; height: 200px;"></canvas>
                </div>
            </div>

            <div class="metric-card">
                <h3>Statistiques</h3>
                <div class="stats-list">
                    <div class="stat-item">
                        <span class="label">Total Prospects:</span>
                        <span class="value">25</span>
                    </div>
                    <div class="stat-item">
                        <span class="label">Taux de Conversion:</span>
                        <span class="value">12%</span>
                    </div>
                    <div class="stat-item">
                        <span class="label">Moyenne par Prospect:</span>
                        <span class="value">45,000 XOF</span>
                    </div>
                    <div class="stat-item">
                        <span class="label">Commission Moyenne:</span>
                        <span class="value">2,700 XOF</span>
                    </div>
                </div>
            </div>

            <div class="metric-card">
                <h3>Activité Récente</h3>
                <div class="activity-list">
                    <div class="activity-item">
                        <span class="time">Il y a 2 heures</span>
                        <p>Nouveau prospect: Mamadou Diop</p>
                    </div>
                    <div class="activity-item">
                        <span class="time">Il y a 5 heures</span>
                        <p>Prospecteur Fatou Ba qualifié</p>
                    </div>
                    <div class="activity-item">
                        <span class="time">Il y a 1 jour</span>
                        <p>Commission payée: 5,400 XOF</p>
                    </div>
                    <div class="activity-item">
                        <span class="time">Il y a 2 jours</span>
                        <p>Prospect converti: Abdoulaye K.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Prospect Modal (Template) -->
<template id="addProspectTemplate">
    <div class="modal" style="max-width: 500px;">
        <div class="modal-header">
            <h2 class="modal-title">Ajouter un Prospect</h2>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <form data-action="prospect">
                <div class="form-group">
                    <label>Nom Complet *</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email">
                </div>
                <div class="form-group">
                    <label>Téléphone *</label>
                    <input type="tel" name="phone" required>
                </div>
                <div class="form-group">
                    <label>Localisation</label>
                    <input type="text" name="location">
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea name="notes"></textarea>
                </div>
                <div class="form-group">
                    <label>Source</label>
                    <select name="source">
                        <option value="direct">Contact Direct</option>
                        <option value="reference">Référence</option>
                        <option value="event">Événement</option>
                        <option value="other">Autre</option>
                    </select>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary" onclick="
                const form = document.querySelector('form[data-action=\\\"prospect\\\"]');
                if (form) form.dispatchEvent(new Event('submit'));
            ">Ajouter</button>
            <button type="button" class="btn btn-secondary" onclick="
                const modal = this.closest('.modal-container');
                modal?.parentElement?.removeChild(modal);
            ">Annuler</button>
        </div>
    </div>
</template>

<style>
    .agent-dashboard {
        padding: 2rem 0;
    }

    .dashboard-header {
        margin-bottom: 2rem;
    }

    .dashboard-header h1 {
        font-size: 2rem;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
    }

    .dashboard-header .subtitle {
        color: var(--text-secondary);
        font-size: 1.1rem;
    }

    /* Stats */
    .stat-box {
        background: linear-gradient(135deg, var(--accent-color), var(--accent-dark));
        color: white;
        border-radius: var(--radius-large);
        padding: 1.5rem;
        text-align: center;
    }

    .stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
        margin-bottom: 0.5rem;
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 700;
    }

    /* Filters */
    .prospects-filters {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
    }

    .prospects-filters input,
    .prospects-filters select {
        flex: 1;
        min-width: 200px;
        padding: 0.75rem;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-medium);
        font-family: 'Poppins', sans-serif;
    }

    /* Prospects Table */
    .prospects-table {
        overflow-x: auto;
    }

    .prospects-table table {
        width: 100%;
        border-collapse: collapse;
        background: var(--bg-primary);
        border-radius: var(--radius-medium);
        overflow: hidden;
    }

    .prospects-table th {
        background: var(--bg-secondary);
        padding: 1rem;
        text-align: left;
        font-weight: 600;
        color: var(--primary-color);
    }

    .prospects-table td {
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
    }

    .prospects-table tbody tr:hover {
        background: var(--bg-secondary);
    }

    .prospect-name {
        font-weight: 600;
        color: var(--primary-color);
    }

    .prospect-status {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .prospect-status.new {
        background: rgba(33, 150, 243, 0.2);
        color: var(--info-color);
    }

    .prospect-status.contacted {
        background: rgba(255, 152, 0, 0.2);
        color: var(--warning-color);
    }

    .prospect-status.qualified {
        background: rgba(76, 175, 80, 0.2);
        color: var(--success-color);
    }

    .prospect-status.converted {
        background: rgba(46, 125, 50, 0.2);
        color: var(--primary-color);
    }

    /* Commissions */
    .commissions-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .commission-card {
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-large);
        padding: 1.5rem;
        text-align: center;
    }

    .commission-card h3 {
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin-bottom: 1rem;
    }

    .commission-value {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--primary-color);
    }

    .commission-value.pending {
        color: var(--warning-color);
    }

    .commissions-table table {
        width: 100%;
        border-collapse: collapse;
        background: var(--bg-primary);
        border-radius: var(--radius-medium);
        overflow: hidden;
    }

    .commissions-table th {
        background: var(--bg-secondary);
        padding: 1rem;
        text-align: left;
        font-weight: 600;
        color: var(--primary-color);
    }

    .commissions-table td {
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
    }

    /* Performance */
    .performance-metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
    }

    .metric-card {
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-large);
        padding: 1.5rem;
    }

    .metric-card h3 {
        color: var(--primary-color);
        margin-bottom: 1rem;
    }

    .metric-bar {
        display: flex;
        height: 30px;
        border-radius: var(--radius-small);
        overflow: hidden;
        gap: 2px;
    }

    .bar-item {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .stats-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .stat-item {
        display: flex;
        justify-content: space-between;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid var(--border-color);
    }

    .stat-item .label {
        color: var(--text-secondary);
    }

    .stat-item .value {
        font-weight: 700;
        color: var(--primary-color);
    }

    .activity-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .activity-item {
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border-color);
    }

    .activity-item:last-child {
        border-bottom: none;
    }

    .activity-item .time {
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    .activity-item p {
        margin: 0.5rem 0 0;
        color: var(--text-primary);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        background: var(--bg-secondary);
        border-radius: var(--radius-large);
    }

    .empty-state svg {
        width: 64px;
        height: 64px;
        color: var(--text-secondary);
        margin-bottom: 1rem;
        opacity: 0.5;
    }

    .empty-state h3 {
        color: var(--primary-color);
        margin-bottom: 0.5rem;
    }

    .empty-state p {
        color: var(--text-secondary);
        margin-bottom: 1.5rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .grid-2,
        .grid-3 {
            grid-template-columns: 1fr;
        }

        .prospects-filters {
            flex-direction: column;
        }

        .prospects-filters input,
        .prospects-filters select {
            min-width: auto;
        }

        .performance-metrics {
            grid-template-columns: 1fr;
        }

        .prospects-table,
        .commissions-table {
            font-size: 0.9rem;
        }

        .prospects-table th,
        .prospects-table td,
        .commissions-table th,
        .commissions-table td {
            padding: 0.75rem 0.5rem;
        }
    }
</style>

<!-- Add Prospect Modal Function -->
<script>
    function openAddProspectModal() {
        const template = document.getElementById('addProspectTemplate');
        const content = template.content.cloneNode(true);

        const container = document.getElementById('modalContainer');
        const wrapper = document.createElement('div');
        wrapper.className = 'modal-container active';

        const overlay = document.createElement('div');
        overlay.className = 'modal-overlay';

        wrapper.appendChild(overlay);
        wrapper.appendChild(content);
        container.appendChild(wrapper);

        const closeBtn = wrapper.querySelector('.modal-close');
        const form = wrapper.querySelector('form[data-action="prospect"]');

        closeBtn?.addEventListener('click', () => wrapper.remove());
        overlay?.addEventListener('click', () => wrapper.remove());

        form?.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);

            // Handle form submission
            console.log('Prospect added:', data);
            showToast('Prospect ajouté avec succès!', 'success');
            wrapper.remove();
        });
    }
</script>
